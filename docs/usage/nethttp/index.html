
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Nethttp - spiderdoctor</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nethttp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="spiderdoctor" class="md-header__button md-logo" aria-label="spiderdoctor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            spiderdoctor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nethttp
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/spidernet-io/spiderdoctor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spidernet-io/spiderdoctor
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../develop/crd/" class="md-tabs__link">
        Develop
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/arch/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../install/" class="md-tabs__link md-tabs__link--active">
        Usage
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="spiderdoctor" class="md-nav__button md-logo" aria-label="spiderdoctor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    spiderdoctor
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spidernet-io/spiderdoctor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spidernet-io/spiderdoctor
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1">
          Develop
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Develop" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Develop
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/crd/" class="md-nav__link">
        develop new crd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/dev/" class="md-nav__link">
        develop
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/arch/" class="md-nav__link">
        architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/report/" class="md-nav__link">
        Report
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../netdns/" class="md-nav__link">
        netdns
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Nethttp
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Nethttp
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concept" class="md-nav__link">
    concept
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debug" class="md-nav__link">
    debug
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#report" class="md-nav__link">
    report
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concept" class="md-nav__link">
    concept
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debug" class="md-nav__link">
    debug
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#report" class="md-nav__link">
    report
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  



  <a href="https://github.com/spidernet-io/spiderdoctor/edit/master/docs/usage/nethttp.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="nethttp">Nethttp</h1>
<h2 id="concept">concept</h2>
<p>Fo this kind task, each spiderdoctor agent will send http request to specified target, and get success rate and mean delay. 
It could specify success condition to tell the result succeed or fail. 
And, more detailed report will print to spiderdoctor agent stdout, or save to disc by spiderdoctor controller.</p>
<p>the following is the spec of nethttp</p>
<pre><code class="language-shell">apiVersion: v1
items:
- apiVersion: spiderdoctor.spidernet.io/v1
  kind: Nethttp
  metadata:
    generation: 1
    name: testhttp1
  spec:
    schedule:
      intervalMinute: 2
      roundNumber: 2
      startAfterMinute: 0
      timeoutMinute: 1
      sourceAgentNodeSelector:
        matchExpressions:
          - { key: &quot;kubernetes.io/hostname&quot;, operator: In, values: [&quot;spiderdoctor-worker&quot;] }
    request:
      durationInSecond: 5
      perRequestTimeoutInMS: 1000
      qps: 10
    target:
      targetUser:
        method: GET
        url: http://172.80.1.2
      targetPod:
        podLabelSelector:
          matchExpressions:
            - { key: &quot;app&quot;, operator: In, values: [&quot;http-server&quot;] }
        httpPort: 80
        method: GET
        testIPv4: true
        testIPv6: true
        testMultusInterface: false
      targetAgent:
        testClusterIp: true
        testEndpoint: true
        testIPv4: true
        testIPv6: true
        testIngress: false
        testMultusInterface: false
        testNodePort: true
    success:
      meanAccessDelayInMs: 10000
      successRate: 1
  status:
    doneRound: 1
    expectedRound: 2
    finish: false
    lastRoundStatus: succeed
    history:
    - deadLineTimeStamp: &quot;2022-11-21T06:19:53Z&quot;
      duration: 10.117152806s
      startTimeStamp: &quot;2022-11-21T06:18:53Z&quot;
      endTimeStamp: &quot;2022-11-21T06:19:03Z&quot;
      failedAgentNodeList: []
      notReportAgentNodeList: []
      roundNumber: 2
      status: notstarted
      succeedAgentNodeList: []
</code></pre>
<ul>
<li>
<p>spec.schedule: set how to schedule the task.</p>
<p>roundNumber: how many rounds it should be to run this task</p>
<p>intervalMinute:  the time interval in minute, for run each round for this task</p>
<p>startAfterMinute: when the start the first round</p>
<p>timeoutMinute: the timeout in minute for each round, when the rask does not finish in time, it results to be failuire</p>
<p>sourceAgentNodeSelector [optional]: set the node label selector, then, the spiderdoctor agent who locates on these nodes will implement the task. If not set this field, all spiderdoctor agent will execute the task</p>
</li>
<li>
<p>spec.request: how each spiderdoctor agent should send the http request</p>
<p>durationInSecond: for each round, the duration in second how long the http request lasts</p>
<p>perRequestTimeoutInMS: timeout in ms for each http request </p>
<p>qps: qps</p>
</li>
<li>
<p>spec.target: set the target of http request. it could not set targetUser and targetAgent at the same time</p>
<p>targetUser [optional]: set an user-defined URL for the http request</p>
<pre><code>url: the url for http

method: http method, must be one of GET POST PUT DELETE CONNECT OPTIONS PATCH HEAD
</code></pre>
<p>targetPod: [optional]: set pods for the http request</p>
<pre><code>podLabelSelector: select the target pods

httpPort: http port

method: http method

testIPv4: test any IPv4 address. Notice, the 'enableIPv4' in configmap  spiderdocter must be enabled

testIPv6: test any IPv6 address. Notice, the 'enableIPv6' in configmap  spiderdocter must be enabled

testMultusInterface: whether send http request to all interfaces ip.
</code></pre>
<p>targetAgent: [optional]: set the http tareget to spiderdoctor agents</p>
<pre><code>testClusterIp: send http request to the cluster ipv4 or ipv6 address of spiderdoctor agnent, according to testIPv4 and testIPv6.

testEndpoint: send http request to other spiderdoctor agnent ipv4 or ipv6 address according to testIPv4 and testIPv6.

testMultusInterface: whether send http request to all interfaces ip in testEndpoint case.

testIPv4: test any IPv4 address. Notice, the 'enableIPv4' in configmap  spiderdocter must be enabled

testIPv6: test any IPv6 address. Notice, the 'enableIPv6' in configmap  spiderdocter must be enabled

testIngress: send http request to the ingress ipv4 or ipv6 address of spiderdoctor agnent

testNodePort: send http request to the nodePort ipv4 or ipv6 address with each local node of spiderdoctor agnent , according to testIPv4 and testIPv6.

&gt;notice: when test targetAgent case, it will send http request to all targets at the same time with spec.request.qps for each one. That meaning, the actually QPS may be bigger than spec.request.qps
</code></pre>
</li>
<li>
<p>spec.success: define the success condition of the task result </p>
<p>meanAccessDelayInMs: mean access delay in MS, if the actual delay is bigger than this, it results to be failure</p>
<p>successRate: the success rate of all http requests. Notice, when a http response code is &gt;=200 and &lt; 400, it's treated as success. if the actual whole success rate is smaller than successRate, the task results to be failure</p>
</li>
<li>
<p>status: the status of the task
    doneRound: how many rounds have finished</p>
<p>expectedRound: how many rounds the task expect</p>
<p>finish: whether all rounds of this task have finished</p>
<p>lastRoundStatus: the result of last round</p>
<p>history:
    roundNumber: the round number</p>
<pre><code>status: the status of this round

startTimeStamp: when this round begins

endTimeStamp: when this round finally finished

duration: how long the round spent

deadLineTimeStamp: the time deadline of a round

failedAgentNodeList: the node list where failed spiderdoctor agent locate

notReportAgentNodeList: the node list where uknown spiderdoctor agent locate. This means these agents have problems.

succeedAgentNodeList: the node list where successful spiderdoctor agent locate
</code></pre>
</li>
</ul>
<h2 id="example">example</h2>
<p>a quick task to test spiderdoctor agent, to verify the whole network is ok, each agent could reach each other</p>
<pre><code class="language-shell">
cat &lt;&lt;EOF &gt; nethttp-test-agent.yaml
apiVersion: spiderdoctor.spidernet.io/v1
kind: Nethttp
metadata:
  name: test-agent
spec:
  schedule:
    startAfterMinute: 0
    roundNumber: 2
    intervalMinute: 2
    timeoutMinute: 1
  request:
    durationInSecond: 2
    qps: 2
    perRequestTimeoutInMS: 1000
  success:
    successRate: 1
    meanAccessDelayInMs: 10000
EOF
kubectl apply -f nethttp-test-agent.yaml

</code></pre>
<p>a detail task to test spiderdoctor agent</p>
<pre><code class="language-shell">cat &lt;&lt;EOF &gt; test-detail-agent.yaml
apiVersion: spiderdoctor.spidernet.io/v1
kind: Nethttp
metadata:
  name: test-detail-agent
spec:
  schedule:
    startAfterMinute: 0
    roundNumber: 2
    intervalMinute: 2
    timeoutMinute: 1
  target:
    targetAgent:
      testIPv4: true
      testIPv6: true
      testEndpoint: true
      testMultusInterface: true
      testClusterIp: true
      testNodePort: true
      testLoadBalancer: true
      testIngress: true
  request:
    durationInSecond: 2
    qps: 2
    perRequestTimeoutInMS: 1000
  success:
    successRate: 1
    meanAccessDelayInMs: 10000
EOF
kubectl apply -f test-detail-agent.yaml

</code></pre>
<p>test custom URL</p>
<pre><code class="language-shell">
cat &lt;&lt;EOF &gt; test-custom.yaml
apiVersion: spiderdoctor.spidernet.io/v1
kind: Nethttp
metadata:
  name: test-custom
spec:
  schedule:
    startAfterMinute: 0
    roundNumber: 2
    intervalMinute: 2
    timeoutMinute: 1
  target:
    targetUser:
      url: &quot;http://172.80.1.2&quot;
      method: &quot;GET&quot;
  request:
    durationInSecond: 10
    qps: 10
    perRequestTimeoutInMS: 1000
  success:
    successRate: 1
    meanAccessDelayInMs: 5000
EOF
kubectl apply -f test-custom.yaml

</code></pre>
<p>use the spicified spiderdoctor agents to send the http request</p>
<pre><code class="language-shell">
cat &lt;&lt;EOF &gt; source-agent.yaml
apiVersion: spiderdoctor.spidernet.io/v1
kind: Nethttp
metadata:
  name: source-agent
spec:
  schedule:
    startAfterMinute: 0
    roundNumber: 2
    intervalMinute: 2
    timeoutMinute: 1
    sourceAgentNodeSelector:
        matchExpressions:
          - { key: &quot;kubernetes.io/hostname&quot;, operator: In, values: [&quot;spiderdoctor-worker&quot;] }
  target:
    targetUser:
      url: &quot;http://172.80.1.2&quot;
      method: &quot;GET&quot;
  request:
    durationInSecond: 10
    qps: 10
    perRequestTimeoutInMS: 1000
  success:
    successRate: 1
    meanAccessDelayInMs: 1000
EOF
kubectl apply -f source-agent.yaml

</code></pre>
<p>test pod</p>
<pre><code class="language-shell">cat &lt;&lt;EOF &gt; test-pod.yaml
apiVersion: spiderdoctor.spidernet.io/v1
kind: Nethttp
metadata:
  name: test-pod
spec:
  schedule:
    startAfterMinute: 0
    roundNumber: 2
    intervalMinute: 2
    timeoutMinute: 1
  target:
    targetPod:
      podLabelSelector:
          matchExpressions:
            - { key: &quot;app&quot;, operator: In, values: [&quot;test&quot;] }
      method: &quot;GET&quot;
      httpPort: 80
      testIPv4: true
      testIPv6: true
      testMultusInterface: true
  request:
    durationInSecond: 2
    qps: 2
    perRequestTimeoutInMS: 1000
  success:
    successRate: 1
    meanAccessDelayInMs: 10000
EOF
kubectl apply -f test-pod.yaml

</code></pre>
<h2 id="debug">debug</h2>
<p>when something wrong happen, see the log for your task with following command</p>
<pre><code class="language-shell">#get log 
CRD_KIND=&quot;nethttp&quot;
CRD_NAME=&quot;test1&quot;
kubectl logs -n kube-system  spiderdoctor-agent-v4vzx | grep -i &quot;${CRD_KIND}.${CRD_NAME}&quot;

</code></pre>
<h2 id="report">report</h2>
<p>when the spiderdoctor is not enabled to aggerate reports, all reports will be printed in the stdout of spiderdoctor agent.
Use the following command to get its report</p>
<pre><code class="language-shell">kubectl logs -n kube-system  spiderdoctor-agent-v4vzx | jq 'select( .TaskName==&quot;nethttp.testhttp1&quot; )'
</code></pre>
<p>when the spiderdoctor is enabled to aggregate reports, all reports will be collected in the PVC or hostPath of spiderdoctor controller.</p>
<p>metric introduction</p>
<pre><code class="language-shell">
        &quot;Metrics&quot;: {
          &quot;latencies&quot;: {
            &quot;total&quot;: 27964545,
            &quot;mean&quot;: 2796454,
            &quot;50th&quot;: 2821970,
            &quot;90th&quot;: 3102803,
            &quot;95th&quot;: 3188759,
            &quot;99th&quot;: 3188759,
            &quot;max&quot;: 3188759,
            &quot;min&quot;: 2362429
          },
          &quot;bytes_in&quot;: {
            &quot;total&quot;: 2357,
            &quot;mean&quot;: 235.7
          },
          &quot;bytes_out&quot;: {
            &quot;total&quot;: 0,
            &quot;mean&quot;: 0
          },
          &quot;earliest&quot;: &quot;2022-11-18T04:55:20.22108713Z&quot;,
          &quot;latest&quot;: &quot;2022-11-18T04:55:24.721276724Z&quot;,
          &quot;end&quot;: &quot;2022-11-18T04:55:24.723858358Z&quot;,
          &quot;duration&quot;: 4500189594,
          &quot;wait&quot;: 2581634, # Wait is the extra time waiting for responses from targets.
          &quot;requests&quot;: 10, #the total number of requests executed
          &quot;rate&quot;: 2.222128599500068, #Rate is the rate of sent requests per second.
          &quot;throughput&quot;: 2.220854556815161, #Throughput is the rate of successful requests per second.
          &quot;success&quot;: 1, #percentage of non-error responses
          &quot;status_codes&quot;: {
            &quot;200&quot;: 10
          },
          &quot;errors&quot;: []
        }
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../netdns/" class="md-footer__link md-footer__link--prev" aria-label="Previous: netdns" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              netdns
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "search.share"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>